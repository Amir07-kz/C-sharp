using System;
using System.Collections.Generic;
using System.Linq;

namespace DzhunuskhodzhaevAmirxan
{
    class WeightedDirectedGraph
    {
        class Depthsearch
        {
            private int V;
            private List<int>[] adj;
            Depthsearch(int v)
            {
                V = v;
                adj = new List<int>[v];
                for (int i = 0; i < v; ++i)
                    adj[i] = new List<int>();
            }
            void AddDepth(int v, int w)
            {
                adj[v].Add(w);
            }
            void DFSUtil(int v, bool[] visited)
            {
                visited[v] = true;
                Console.Write(v + " ");
                List<int> vList = adj[v];
                foreach (var n in vList)
                {
                    if (!visited[n])
                        DFSUtil(n, visited);
                }
            }
            void DFS(int v)
            {
                bool[] visited = new bool[V];
                DFSUtil(v, visited);
            }
            class Breadth
            {
                private int _V;
                LinkedList<int>[] _adj;

                public Breadth(int V)
                {
                    _adj = new LinkedList<int>[V];
                    for (int i = 0; i < _adj.Length; i++)
                    {
                        _adj[i] = new LinkedList<int>();
                    }
                    _V = V;
                }
                public void AddBreadth(int v, int w)
                {
                    _adj[v].AddLast(w);

                }
                public void BFS(int s)
                {
                    bool[] visited = new bool[_V];
                    for (int i = 0; i < _V; i++)
                        visited[i] = false;
                    LinkedList<int> queue = new LinkedList<int>();
                    visited[s] = true;
                    queue.AddLast(s);

                    while (queue.Any())
                    {
                        s = queue.First();
                        Console.Write(s + " ");
                        queue.RemoveFirst();
                        LinkedList<int> list = _adj[s];

                        foreach (var val in list)
                        {
                            if (!visited[val])
                            {
                                visited[val] = true;
                                queue.AddLast(val);
                            }
                        }
                    }
                }
                public class Trees
                {
                    public class Tree
                    {
                        public int key;
                        public Tree left, right;
                    }
                    public static Tree newConnection(int key)
                    {
                        Tree node = new Tree();
                        node.key = key;
                        node.left = node.right = null;
                        return (node);
                    }
                    public static int addBT(Tree root)
                    {
                        if (root == null)
                        {
                            return 0;
                        }
                        return (root.key + addBT(root.left) + addBT(root.right));
                    }
                    public class Vertexs
                    {
                        public int key;
                        public Vertexs left, right;

                        public Vertexs(int item)
                        {
                            key = item;
                            left = right = null;
                        }
                    }
                    public class BinaryTreeOfRecursion
                    {
                        Vertexs vertex2;
                        BinaryTreeOfRecursion()
                        {
                            vertex2 = null;
                        }
                        void printPreorder(Vertexs node)
                        {
                            if (node == null)
                                return;
                            Console.Write(node.key + " ");
                            printPreorder(node.left);
                            printPreorder(node.right);
                        }
                        void printPreorder() { printPreorder(vertex2); }
                        public class TreesBalance
                        {
                            public Vertexs balance;
                            public virtual bool isBalanced(Vertexs balance)
                            {
                                int lh;
                                int rh;
                                if (balance == null)
                                {
                                    return true;
                                }
                                lh = height(balance.left);
                                rh = height(balance.right);

                                if (Math.Abs(lh - rh) <= 1 && isBalanced(balance.left)
                                    && isBalanced(balance.right))
                                {
                                    return true;
                                }
                                return false;
                            }
                            public virtual int height(Vertexs node)
                            {
                                if (node == null)
                                {
                                    return 0;
                                }
                                return 1 + Math.Max(height(node.left), height(node.right));
                            }
                            static void Main()
                            {
                                Console.WriteLine("                Матрица инцидентности      \n");
                                Console.WriteLine("___________________________________");
                                Console.WriteLine("      |      |      |      |      |");
                                Console.WriteLine("      |  1   |  2   |  3   |  4   |");

                                const int v = 4;
                                const int n = 5;
                                int[,] ms = new int[n, v] { { 1, 2, 3, 4},
                                             {0 , 0 , 0 , 1 },
                                             {1 , 0 , 1 , 0 },
                                             {0 , 1 , 0 , 1 },
                                             {1 , 1 , 0 , 0 } };


                                for (var j = 0; j < ms.GetLength(1); j++)
                                {
                                    Console.WriteLine("------|------|------|------|------|");
                                    for (var i = 0; i < ms.GetLength(0); i++)
                                    {
                                        Console.Write("  {0}   |", ms[i, j]);
                                    }
                                    Console.WriteLine();
                                }
                                Console.WriteLine("----------------------------------|");

                                Breadth g = new Breadth(5);

                                g.AddBreadth(2, 4);
                                g.AddBreadth(2, 3);
                                g.AddBreadth(4, 1);
                                g.AddBreadth(1, 2);
                                g.AddBreadth(2, 3);

                                Console.WriteLine("\n\n");
                                Console.WriteLine(" __V__                  __V__                  ");
                                Console.WriteLine(" |   |                  |   |                  ");
                                Console.WriteLine(" | 1 |----------------->| 2 |                  ");
                                Console.WriteLine(" |___|                  |___|                  ");
                                Console.WriteLine("   |                    / |                    ");
                                Console.WriteLine("   |                   /  |                    ");
                                Console.WriteLine("   |                  /   |                    ");
                                Console.WriteLine("   |                 /    |                    ");
                                Console.WriteLine("   |                /     |                    ");
                                Console.WriteLine("   |               /      |                    ");
                                Console.WriteLine("   |              /       |                    ");
                                Console.WriteLine("   |             /        |                    ");
                                Console.WriteLine("   |            /         |                    ");
                                Console.WriteLine("   |           /          |                    ");
                                Console.WriteLine("   |          /           |                    ");
                                Console.WriteLine("   |         /            |                    ");
                                Console.WriteLine("   |        /             |                    ");
                                Console.WriteLine(" __|__     /            __|__                  ");
                                Console.WriteLine(" |   |<-- /             |   |                  ");
                                Console.WriteLine(" | 4 |----------------->| 3 |                  ");
                                Console.WriteLine(" |___|                  |___|                  ");

                                Console.WriteLine("");
                                Console.WriteLine("Далее следует в ширину(начиная с вершины 2)\n");

                                g.BFS(2);

                                Console.WriteLine("\n\n\n");

                                Depthsearch s = new Depthsearch(8);

                                s.AddDepth(1, 4);
                                s.AddDepth(1, 2);
                                s.AddDepth(2, 4);
                                s.AddDepth(2, 3);
                                s.AddDepth(4, 3);

                                Console.WriteLine("Далее следует обход глубины(начиная с вершины 1)\n");
                                s.DFS(1);
                                Console.WriteLine("\n\n\n");

                                Tree vertex = newConnection(1);
                                vertex.left = newConnection(2);
                                vertex.right = newConnection(3);
                                vertex.left.left = newConnection(4);
                                vertex.left.right = newConnection(5);
                                vertex.right.left = newConnection(6);
                                vertex.right.right = newConnection(7);
                                vertex.right.left.left = newConnection(8);

                                Console.WriteLine("Дерево :");

                                Console.WriteLine("                                                          ");
                                Console.WriteLine("                           (  1  )                        ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("                       /            \\                    ");
                                Console.WriteLine("                      /              \\                   ");
                                Console.WriteLine("                     /                \\                  ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("             (  2  )                    (  3  )           ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("             /     \\                   /      \\         ");
                                Console.WriteLine("            /       \\                 /        \\        ");
                                Console.WriteLine("           /         \\               /          \\       ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("     (  4  )         (  5  )    (  6  )          (  7  )  ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("                                /                         ");
                                Console.WriteLine("                               /                          ");
                                Console.WriteLine("                              /                           ");
                                Console.WriteLine("                                                          ");
                                Console.WriteLine("                        (  8  )                           ");
                                Console.WriteLine("                                                          ");

                                int sum = addBT(vertex);
                                Console.WriteLine("Сумма всех элементов в дереве: " + sum);

                                BinaryTreeOfRecursion tree = new BinaryTreeOfRecursion();
                                tree.vertex2 = new Vertexs(1);
                                tree.vertex2.left = new Vertexs(2);
                                tree.vertex2.right = new Vertexs(3);
                                tree.vertex2.left.left = new Vertexs(4);
                                tree.vertex2.left.right = new Vertexs(5);
                                tree.vertex2.right.left = new Vertexs(6);
                                tree.vertex2.right.right = new Vertexs(7);
                                tree.vertex2.right.left.left = new Vertexs(8);

                                Console.WriteLine("");
                                Console.WriteLine("Обход дерева в глубину ( с использованием рекурсии )");
                                tree.printPreorder();
                                Console.WriteLine("\n");
                                Console.WriteLine("Обход дерева в глубину ( не с использованием рекурсии )");
                                Depthsearch r = new Depthsearch(9);

                                r.AddDepth(1, 2);
                                r.AddDepth(1, 3);
                                r.AddDepth(2, 4);
                                r.AddDepth(2, 5);
                                r.AddDepth(3, 6);
                                r.AddDepth(3, 7);
                                r.AddDepth(6, 8);
                                r.DFS(1);
                                Console.WriteLine("\n");

                                Console.WriteLine("Обход дерева в ширину");
                                Breadth h = new Breadth(9);

                                h.AddBreadth(1, 2);
                                h.AddBreadth(1, 3);
                                h.AddBreadth(2, 4);
                                h.AddBreadth(2, 5);
                                h.AddBreadth(3, 6);
                                h.AddBreadth(3, 7);
                                h.AddBreadth(6, 8);
                                h.BFS(1);
                                Console.WriteLine("\n");

                                Console.WriteLine("Проверка дерева на сбалансированность");

                                TreesBalance treeBalance = new TreesBalance();
                                treeBalance.balance  = new Vertexs(1);
                                treeBalance.balance.left = new Vertexs(1);
                                treeBalance.balance.right = new Vertexs(2);
                                treeBalance.balance.left.left = new Vertexs(4);
                                treeBalance.balance.left.right = new Vertexs(5);
                                treeBalance.balance.right.left = new Vertexs(6);
                                treeBalance.balance.right.right = new Vertexs(7);
                                treeBalance.balance.left.left = new Vertexs(8);

                                if (treeBalance.isBalanced(treeBalance.balance))
                                {
                                    Console.WriteLine("Дерево сбалансированно");
                                }
                                else
                                {
                                    Console.WriteLine("Дерево не сбалансированно");
                                }

                                Console.ReadKey();
                            }
                        }
                    }
                }
            }
        }
    }
}
